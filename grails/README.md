# Grails
Grails is a web development framework in use on several ADI developed/supported sites. It is based on Spring MVC and Hibernate but written in Groovy and favors convention over configuration. Resulting sites are clean (fewer artifacts and lines of code than Spring MVC), based on conventions, and very testable.

## General Resources
The [Grails development guide] is well written and you should read through entirely. Always start with the development guide.

[This blog posting] discusses how to set up your own project as a plugin so you can share common functionality across Grails project. For instance, the CSA project uses this technique for all domain classes and some common services.

## Working With Existing Oracle DB

Some of these tips are applicable to working with any existing database, but some are specific to Oracle.

- Use the DB Reverse Engineer plugin to give you a good head start on generating domain classes from your tables, but don't expect it to get you all the way there. Read the plugin documentation carefully.

- You probably need to set 'grails.plugin.reveng.defaultSchema'. See the plugin documentation.

- The plugin will occasionally modify existing classes. Be sure you have backups or check in to version control prior to running.

- Oracle usually uses sequences for primary keys. You will need to change the id column definition in the generated domain class to something like the following:

    `id column:'the_id_column', generator:'sequence', params:[sequence:'the_id_seq']`

- For char fields, you'll want to add <column variable name> column: "<column name in table>", sqlType:"char" in the mapping.  The reverse engineering doesn't do this by default and without it, dbCreate "validate" will fail saying it found char, expecting varchar.    Note: reverse engineering removes "_" (underscores), so a field like status_code becomes the variable statusCode, thus the entry for this would be statusCode column: "status_code", sqlType:"char".   MORE NOTES: simply statusCode sqlType: "char" works as well.  The column name from the table is only needed if standards naming is not used (like using statusCd).
     
- You may need to rename some attributes that represent foreign keys when the column name in the table is different than the class name. For instance, in the database the BOOK table has a PRIMARY_AUTHOR_ID column which is a foreign key to AUTHOR. The Book domain class generated by the plugin will have an attribute of type Author called 'author'. So Hibernate will look for a column called AUTHOR_ID. Change the attribute to primaryAuthor and Hibernate will find the column correctly.

- Most field types are mapped correctly, but you may run into trouble if you use NVARCHAR2 or NCLOB. The plugin makes these Serializable. In the 'mapping' block, just put 'sqlType: "nvarchar2"' or 'sqlType: "nclob"' by the appropriate attribute.

- If you use a timestamp for versioning rather than an integer, you will need to import java.sql.Timestamp and specify attribute "Timestamp version"

## Integrating with Shibboleth
If needing to integrate Grails with Shibboleth, see these [useful tips].

## Logging in Tomcat

You may need to put something like the following in place in Config.groovy to get your log files to log to the correct location in Tomcat in Shared Java Hosting, though it looks like this may be the default behavior in Grails v 2.2.2

```
log4j.main = {
    //Creates stacktrace.log file in 'logs' dir if deployed in tomcat, in 'target' dir if running locally
    String logDir = grails.util.Environment.warDeployed ? System.getProperty('catalina.home') + '/logs' : 'target'
    file name: 'stacktrace',
    file: "$logDir/stacktrace.log",
    layout: pattern(conversionPattern: "'%d [%t] %-5p %c{2} %x - %m%n'") 

... etc ...
```

## Tier-Specific Settings
See the WIKI for useful setup for [tier-specific settings] on Shared Hosting.

[Grails development guide]:http://grails.org/doc/latest/guide/
[This blog posting]:http://www.bobbywarner.com/2011/06/21/grails-setup/
[useful tips]:https://wiki.doit.wisc.edu/confluence/display/DOIT/Grails
[tier-specific settings]:https://wiki.doit.wisc.edu/confluence/display/DOIT/Grails
